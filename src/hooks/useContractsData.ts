import { useState } from "react";

export interface Section {
  title: string;
  items: string[];
}

export interface PaymentStep {
  percentage: string;
  description: string;
}

export interface ContractData {
  title: string;
  location: string;
  price: string;
  sections: Section[];
  payments: PaymentStep[];
  timeline?: string[];
  notes: string[];
}

export interface ContractsData {
  addition: ContractData;
  expansion: ContractData;
  licensing: ContractData;
}

const initialContractsData: ContractsData = {
  addition: {
    title: "הצעת מחיר לתוספת בניה",
    location: "גוש 6273, חלקה 27, מגרש 921 - כפר חב\"ד",
    price: "₪35,000",
    sections: [
      {
        title: "שלב ראשון - בדיקת היתכנות ותכנון",
        items: [
          "בירור תוכניות בנין עיר (תב\"ע) החלות על המגרש",
          "בדיקת סטטוס המגרש ובדיקת היתכנות",
          "הזמנת תיק מידע מהרשויות ובחינת היתרי הבניה",
          "השוואה למצב הקיים וגיבוש זכויות הבניה",
          "הכנת פרוגרמה מפורטת עם המזמינים",
          "עד 3 חלופות תכנון רעיוני למזמינים",
          "תוכנית חלוקת החללים והעמדת ריהוט",
        ],
      },
      {
        title: "רישוי",
        items: [
          "עריכת והגשת בקשה להיתר לוועדה לתכנון ובניה",
          "תיאום בין היועצים השונים הנדרשים",
          "השתתפות בפגישות ודיונים עם המוסדות המאשרים",
          "חתימת הרשויות השונות לרבות רמ\"י והג\"א",
          "קידום לקבלת היתר בניה (למעט החתמת שכנים ווועד)",
        ],
      },
      {
        title: "שלב שני - תוכניות ביצוע",
        items: [
          "תוכניות עבודה אדריכליות מפורטות: תכנית הקומות, חתכים, חזיתות",
          "תוכנית העמדת הבניין במגרש, תכנית מדרגות",
          "פיתוח השטח: גדרות, שבילי כניסה וחניה, מפלסים, ריצוף חוץ וצמחייה",
          "פגישה עם קבלן מבצע להסברת התוכנית ומתן הנחיות",
          "פיקוח עליון לצורכי רישוי בלבד",
        ],
      },
      {
        title: "כללי",
        items: [
          "המזמינים יזמינו על חשבונם את השירותים והיועצים הנדרשים",
          "לעורכי הבקשה אין אחריות לתשלומים לוועדה לתכנון ובניה",
          "המזמינים ידאגו למילוי הוראות הבטיחות באתר",
          "מומלץ שירותי קבלנים רשומים ומפקח בניה צמוד",
        ],
      },
    ],
    payments: [
      { percentage: "25%", description: "חתימת חוזה" },
      { percentage: "30%", description: "חתימה על תכנית הגשה" },
      { percentage: "30%", description: "אישור מהוועדה (היתר בתנאים)" },
      { percentage: "15%", description: "קבלת היתר" },
    ],
    timeline: [
      "בדיקת היתכנות מול הרשויות - תיק מידע",
      "מסירת סקיצה ראשונה למזמין - 25 י\"ע מקבלת מפת המדידה",
      "עיבוד החלופה הנבחרת - 12 י\"ע לאחר משוב המזמין",
      "הגשת תוכניות לרשויות - 21 י\"ע מאישור סופי של המזמין",
      "הכנת תוכנית עבודה לביצוע - 45 י\"ע מרגע קבלת היתר",
    ],
    notes: [
      "במקרה של ביטול הסכם - הסכום יוחזר למזמינים בטרם החלה בדיקת ההיתכנות",
      "אם המזמינים הפסיקו ההתקשרות - ישלמו עבור כל השלבים שהוכנו",
      "ההסכם אינו כולל תכניות שינוי תב\"ע מקומית/מחוזית",
      "לא יתוכננו חללים שאינם כלולים בהיתר והחורגים מהתוכניות",
      "אם הליך ההיתר יופסק לתקופה שמעבר לחצי שנה - עורכי הבקשה לא מחויבים להמשיך",
      "תוספת תשלום בכל שינוי בפרוגרמה מאושרת, בחלופה או בתוכניות עבודה",
      "שעת עבודה נוספת - ₪250 + מע\"מ",
    ],
  },
  expansion: {
    title: "הצעת מחיר להרחבה צפונית",
    location: "גוש 7311, חלקה A, מגרש B - כפר חב\"ד (הרחבה צפונית)",
    price: "₪37,000",
    sections: [
      {
        title: "שלב ראשון - בדיקת היתכנות ותכנון",
        items: [
          "בירור תוכניות בנין עיר (תב\"ע) החלות על המגרש",
          "בדיקת סטטוס המגרש ובדיקת היתכנות",
          "הזמנת תיק מידע מהרשויות ובחינת היתרי הבניה",
          "השוואה למצב הקיים וגיבוש זכויות הבניה",
          "הכנת פרוגרמה מפורטת עם המזמינים",
          "עד 3 חלופות תכנון רעיוני למזמינים",
          "תוכנית חלוקת החללים והעמדת ריהוט",
        ],
      },
      {
        title: "רישוי",
        items: [
          "עריכת והגשת בקשה להיתר לוועדה לתכנון ובניה",
          "תיאום בין היועצים השונים הנדרשים",
          "השתתפות בפגישות ודיונים עם המוסדות המאשרים",
          "חתימת הרשויות השונות לרבות רמ\"י והג\"א",
          "קידום לקבלת היתר בניה (למעט החתמת שכנים ווועד)",
        ],
      },
      {
        title: "שלב שני - תוכניות ביצוע",
        items: [
          "תוכניות עבודה אדריכליות מפורטות: תכנית הקומות, חתכים, חזיתות",
          "תוכנית העמדת הבניין במגרש, תכנית מדרגות",
          "פיתוח השטח: גדרות, שבילי כניסה וחניה, מפלסים, ריצוף חוץ וצמחייה",
          "פגישה עם קבלן מבצע להסברת התוכנית ומתן הנחיות",
          "פיקוח עליון לצורכי רישוי בלבד",
        ],
      },
      {
        title: "כללי",
        items: [
          "המזמינים יזמינו על חשבונם את השירותים והיועצים הנדרשים",
          "לעורכי הבקשה אין אחריות לתשלומים לוועדה לתכנון ובניה",
          "המזמינים ידאגו למילוי הוראות הבטיחות באתר",
          "מומלץ שירותי קבלנים רשומים ומפקח בניה צמוד",
        ],
      },
    ],
    payments: [
      { percentage: "25%", description: "חתימת חוזה" },
      { percentage: "30%", description: "חתימה על תכנית הגשה" },
      { percentage: "30%", description: "אישור מהוועדה (היתר בתנאים)" },
      { percentage: "15%", description: "קבלת היתר" },
    ],
    timeline: [
      "בדיקת היתכנות מול הרשויות - תיק מידע",
      "מסירת סקיצה ראשונה למזמין - 25 י\"ע מאישור וחתימה",
      "עיבוד החלופה הנבחרת - 12 י\"ע לאחר משוב המזמין",
      "הגשת תוכניות לרשויות - 21 י\"ע מאישור סופי של המזמין",
      "הכנת תוכנית עבודה לביצוע - 45 י\"ע מרגע קבלת היתר",
    ],
    notes: [
      "במקרה של ביטול הסכם - הסכום יוחזר למזמינים בטרם החלה בדיקת ההיתכנות",
      "אם המזמינים הפסיקו ההתקשרות - ישלמו עבור כל השלבים שהוכנו",
      "ההסכם אינו כולל תכניות שינוי תב\"ע מקומית/מחוזית",
      "לא יתוכננו חללים שאינם כלולים בהיתר והחורגים מהתוכניות",
      "תוספת ליחידת דיור נוספת (אופציה עתידית): ₪5,000",
      "שעת עבודה נוספת - ₪250 + מע\"מ",
    ],
  },
  licensing: {
    title: "הצעת מחיר לרישוי בלבד",
    location: "גוש 7188, חלקה 50, מגרש 166 - כפר חב\"ד",
    price: "₪30,000",
    sections: [
      {
        title: "שלב ראשון - רישוי",
        items: [
          "בירור תוכניות בנין עיר (תב\"ע) החלות על המגרש",
          "בדיקת סטטוס המגרש ובדיקת היתכנות",
          "עורכי הבקשה ימסרו לאדריכל המתכנן את סך הזכויות ותיק המידע",
          "עורכי הבקשה יקבלו מהאדריכל המתכנן גרמושקא ערוכה להגשה",
          "הגשת בקשה להיתר לוועדה לתכנון ובניה",
          "תיאום בין היועצים השונים הנדרשים",
          "השתתפות בפגישות ודיונים עם המוסדות המאשרים",
          "חתימת הרשויות השונות לרבות רמ\"י והג\"א (למעט שכנים ווועד)",
        ],
      },
      {
        title: "שלב שני - פיקוח",
        items: [
          "פיקוח עליון לצורכי רישוי בלבד",
          "ביקורים באתר לפני יציקת תקרות ורצפה",
          "ביקור בעת בניית שורה ראשונה של אבן ראשונה",
          "ביקור בהגעה לגובה ספי חלונות",
          "התערבות המתכנן במקרים הדורשים פתרון בעיות",
        ],
      },
      {
        title: "כללי",
        items: [
          "המזמינים יזמינו על חשבונם את השירותים והיועצים הנדרשים",
          "לעורכי הבקשה אין אחריות לתשלומים לוועדה לתכנון ובניה",
          "המזמינים ידאגו למילוי הוראות הבטיחות באתר",
          "מומלץ שירותי קבלנים רשומים ומפקח בניה צמוד",
        ],
      },
    ],
    payments: [
      { percentage: "25%", description: "חתימת חוזה" },
      { percentage: "30%", description: "חתימה על תכנית הגשה" },
      { percentage: "30%", description: "אישור מהוועדה (היתר בתנאים)" },
      { percentage: "15%", description: "קבלת היתר" },
    ],
    notes: [
      "במקרה של ביטול הסכם - הסכום יוחזר למזמינים בטרם החלה בדיקת ההיתכנות",
      "אם המזמינים הפסיקו ההתקשרות - ישלמו עבור כל השלבים שהוכנו",
      "ההסכם אינו כולל תכניות שינוי תב\"ע מקומית/מחוזית",
      "לא יתוכננו חללים שאינם כלולים בהיתר והחורגים מהתוכניות במוסדות התכנון",
      "עריכת גרמושקא על פי תוכניות שיימסרו מהאדריכל המתכנן",
      "התאמת תוכניות אדריכל מתכנן לרישוי",
      "שעת עבודה נוספת - ₪250 + מע\"מ",
    ],
  },
};

export const useContractsData = () => {
  const [contractsData, setContractsData] = useState<ContractsData>(initialContractsData);
  const [isEditMode, setIsEditMode] = useState(false);

  const updateContract = (
    contractType: keyof ContractsData,
    field: keyof ContractData,
    value: string
  ) => {
    setContractsData((prev) => ({
      ...prev,
      [contractType]: {
        ...prev[contractType],
        [field]: value,
      },
    }));
  };

  const updateSectionItem = (
    contractType: keyof ContractsData,
    sectionIndex: number,
    itemIndex: number,
    value: string
  ) => {
    setContractsData((prev) => {
      const newSections = [...prev[contractType].sections];
      newSections[sectionIndex] = {
        ...newSections[sectionIndex],
        items: newSections[sectionIndex].items.map((item, i) =>
          i === itemIndex ? value : item
        ),
      };
      return {
        ...prev,
        [contractType]: {
          ...prev[contractType],
          sections: newSections,
        },
      };
    });
  };

  const updateNote = (
    contractType: keyof ContractsData,
    noteIndex: number,
    value: string
  ) => {
    setContractsData((prev) => ({
      ...prev,
      [contractType]: {
        ...prev[contractType],
        notes: prev[contractType].notes.map((note, i) =>
          i === noteIndex ? value : note
        ),
      },
    }));
  };

  return {
    contractsData,
    isEditMode,
    setIsEditMode,
    updateContract,
    updateSectionItem,
    updateNote,
  };
};
